<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Investment</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/form">Add</a></li>
        <li><a href="/table">Check</a></li>
        <li><a href="/graphs">Graphs</a></li>
    </ul>
</nav>

<!-- Add Investment Form -->
<div class="container">
    <h2>Add Your Investment</h2>
    <form id="investmentForm">
        <label for="name">Asset Name</label>
        <input type="text" id="name" name="name" required>

        <label for="type">Asset Type</label>
        <select id="type" name="type" onchange="toggleFields()">
            <option value="Stock">Stock</option>
            <option value="Gold">Gold</option>
            <option value="Bond">Bond</option>
            <option value="Savings">Savings Account</option>
            <option value="Crypto">Crypto</option>
        </select>

        <div id="tickerField">
            <label for="ticker">Ticker Symbol</label>
            <input type="text" id="ticker" name="ticker">
        </div>

        <div id="priceField">
            <label for="price">Price per Unit</label>
            <input type="number" id="price" name="price">
        </div>

        <label for="amount">Amount</label>
        <input type="number" id="amount" name="amount" required>

        <label for="currency">Currency</label>
        <select id="currency" name="currency">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
        </select>

        <div id="interestFields" class="hidden">
            <label for="interestStart">Interest Start Date</label>
            <input type="date" id="interestStart" name="interestStart">

            <label for="interestRate">Interest Rate (%)</label>
            <input type="number" id="interestRate" name="interestRate" step="0.01">

            <label for="compoundingFrequency">Compounding Frequency</label>
            <select id="compoundingFrequency" name="compoundingFrequency">
                <option value="daily">Daily</option>
                <option value="monthly">Monthly</option>
                <option value="quarterly">Quarterly</option>
                <option value="annually">Annually</option>
            </select>
        </div>

        <button type="submit">Add Investment</button>
    </form>
</div>

<script>
    function toggleFields() {
        const type = document.getElementById("type").value;
        const tickerField = document.getElementById("tickerField");
        const priceField = document.getElementById("priceField");
        const interestFields = document.getElementById("interestFields");

        if (type === "Savings" || type === "Bond") {
            interestFields.classList.remove("hidden");
        } else {
            interestFields.classList.add("hidden");
        }

        if (type === "Stock" || type === "Crypto" || type === "Gold") {
            tickerField.style.display = "block";
            priceField.style.display = "block";
        } else {
            tickerField.style.display = "none";
            priceField.style.display = "none";
        }
    }

    document.getElementById("investmentForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const interestStartDate = document.getElementById("interestStart").value;
        let formattedInterestStart = null;
        if (interestStartDate) {
            formattedInterestStart = `${interestStartDate}T00:00:00Z`;
        }

        const formData = {
            name: document.getElementById("name").value,
            type: document.getElementById("type").value,
            ticker: document.getElementById("ticker").value || null,
            price: document.getElementById("price").value ? parseFloat(document.getElementById("price").value) : null,
            amount: parseFloat(document.getElementById("amount").value),
            currency: document.getElementById("currency").value,
            interestStart: formattedInterestStart,
            interestRate: document.getElementById("interestRate").value ? parseFloat(document.getElementById("interestRate").value) : null,
            compoundingFrequency: document.getElementById("compoundingFrequency").value || null
        };

        console.log("Submitting:", formData);

        fetch("/api/assets", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData)
        })
        .then(response => response.json())
        .then(data => {
            alert("Investment added successfully!");
            document.getElementById("investmentForm").reset();
            toggleFields(); // Reset visibility
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Failed to add investment.");
        });
    });

    toggleFields();
</script>

</body>
</html>
